{% load static %}

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weapon Detection System - Alert Details</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <meta name="csrf-token" content="{{ csrf_token }}">
  
  <!-- Cargar el archivo CSS específico de alertas -->
  <link rel="stylesheet" href="{% static 'css/alert.css' %}">
</head>

<body>
  <!-- Incluir el navbar moderno -->
  {% include 'detection/navbar.html' %}

  <div class="alert-root">
    <!-- Animated Background -->
    <div class="alert-background">
      <div class="alert-background-grid">
        <div class="bg-element" style="grid-area: top / start / 8 / end;">
          <div style="background: linear-gradient(rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.9) 33%); height: 100%;"></div>
        </div>
        <div class="bg-element bg-border animate-left" style="grid-area: 4 / 2 / auto / 5;"></div>
        <div class="bg-element bg-dark" style="grid-area: 6 / start / auto / 2;"></div>
        <div class="bg-element bg-blue animate-left" style="grid-area: 7 / start / auto / 4;"></div>
        <div class="bg-element bg-gray animate-left" style="grid-area: 8 / 4 / auto / 6;"></div>
        <div class="bg-element bg-cyan animate-right" style="grid-area: 2 / 15 / auto / end;"></div>
        <div class="bg-element bg-blue animate-right" style="grid-area: 3 / 14 / auto / end;"></div>
        <div class="bg-element bg-gray animate-right" style="grid-area: 4 / 17 / auto / 20;"></div>
        <div class="bg-element bg-border animate-right" style="grid-area: 5 / 14 / auto / 17;"></div>
      </div>
    </div>

    <!-- Alert Content -->
    <div class="alert-container">
      <!-- Back Button -->
      <a href="{% url 'home' %}" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Volver al Panel de Control
      </a>

      <!-- Alert Header -->
      <div class="alert-header">
        <h1 class="alert-title">
          <i class="fas fa-exclamation-triangle"></i>
          Alerta de Detección de Armas
        </h1>
        <span class="alert-status">
          <i class="fas fa-shield-alt"></i>
          AMENAZA ACTIVA DETECTADA
        </span>
      </div>

      <!-- Content Grid -->
      <div class="content-grid">
        <!-- Image Section -->
        <div class="image-card">
          <h2 class="image-header">
            <i class="fas fa-camera"></i>
            Evidencia de Detección
          </h2>
          {% for alert in uploadAlert %}
          <img class="detection-image-large" 
               src='https://weapondetectionsystem.s3.us-east-1.amazonaws.com/media/{{alert.image}}' 
               alt="Weapon Detection Evidence"/>
          <p class="image-caption">Arma detectada en video de seguridad - {{ alert.dateCreated|date:"F j, Y at g:i A" }}</p>
          {% endfor %}
        </div>

        <!-- Info Section -->
        <div class="info-card">
          <h2 class="info-header">
            <i class="fas fa-info-circle"></i>
            Detalles de la Alerta
          </h2>
          
          <table class="info-table">
            {% for alert in uploadAlert %}
            <tr>
              <td class="info-label">Ubicación</td>
              <td class="info-value location-value">
                <i class="fas fa-map-marker-alt"></i>
                {{ alert.location }}
              </td>
            </tr>
            <tr>
              <td class="info-label">Alerta Enviada A</td>
              <td class="info-value receiver-value">
                <i class="fas fa-user-shield"></i>
                {{ alert.alertReceiver }}
              </td>
            </tr>
            <tr>
              <td class="info-label">Hora de Detección</td>
              <td class="info-value time-value">
                <i class="fas fa-clock"></i>
                {{ alert.dateCreated|date:"Y-m-d H:i:s" }}
              </td>
            </tr>

            {% endfor %}
          </table>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="actions-section">
        <h3 class="actions-title">Acciones Disponibles</h3>
        <div class="actions-buttons">
          <button onclick="downloadReport()" class="action-btn">
            <i class="fas fa-download"></i>
            Descargar Reporte
          </button>
          <button onclick="archiveAlert()" class="action-btn danger" id="archiveBtn">
            <i class="fas fa-archive"></i>
            Archivar Alerta
          </button>
        </div>
        
        <!-- Status Messages -->
        <div id="statusMessage" class="status-message" style="display: none;">
          <i class="fas fa-check-circle"></i>
          <span id="statusText"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Incluir el footer -->
  {% include 'detection/footer.html' %}

  <!-- JavaScript externo sería mejor separarlo también -->
  <script src="{% static 'js/alert.js' %}"></script>

  <!-- CSRF Token para formularios -->
  {% csrf_token %}
</body>
</html>